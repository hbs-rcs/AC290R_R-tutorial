---
title: Data Visualization
slug: data-visualization
minutes: 30
weight: 40
---

```{r, echo=FALSE}
knitr::opts_chunk$set(results = "hide", fig.align = "center")
```


# Learning Objectives

* Introduce plotting using base R
* Compare to plotting with `ggplot2`
* Show how to save graphs to file


# Old School: `graphics`

When we are working with large sets of numbers it can be useful to display that information graphically. R has a number of built-in tools for basic graph types such as scatter plots, hisotgrams, box plots and much [more](http://www.statmethods.net/graphs/). We'll test a few of these out here on the `gapminder` data.

```{r simplestats}
gapminder <- read.csv("data/gapminder-FiveYearData.csv")
```

## Scatter Plot

A scatter plot provides a graphical view of the relationship between two sets of numbers.

```{r}
plot(
    x = gapminder$year,
    y = gapminder$lifeExp,
    main = "Life Expectancy Over Time",
    xlab = "",
    ylab = "Life Expectancy (Years)"
)
```

Each point in this graph shows there was a country in year $x$ with life expectancy $y$. For any plot you can customize many features of your graphs (fonts, colors, axes, titles) using the `par()` function. Read the `help(par)` page for more details.

## Histogram

Another way to visualize the distribution of life expectancies is to use a histogram, we can do this buy using the `hist()` function:

```{r}
x <- gapminder$lifeExp

hist(
    x = x,
    xlab = "Life Expectancy (Years)",
    main = "Distribution of Life Expectancy",
    breaks = floor(min(x)) : ceiling(max(x))
)
```

## Box Plot

How has life expectancy changed over time? A box plot provides a graphical view of the median, quartiles, maximum, and minimum of a data set. Similar to the scatterplots above, we can pass in arguments to add in extras like plot title, axis labels and colors.

```{r}
boxplot(
    lifeExp ~ year,
    gapminder,
    main = "The Distribution of Life Expectancy Over Time",
    ylab = "Life Expectancy (Years)"
)
```


# New School: `ggplot2`

More recently, R users have moved away from base graphic options and towards a plotting package called [`ggplot2`](http://docs.ggplot2.org/) that adds a lot of functionality to the basic plots seen above. The syntax takes some getting used to but it's extremely powerful and flexible. We can start by re-creating some of the above plots but using ggplot functions to get a feel for the syntax.

`ggplot` is best used on data in the `data.frame` form, so we will will work with `gapminder` for the following figures. Let's start by loading the `ggplot2` library.

```{r}
library(ggplot2)
```

The `ggplot()` function is used to initialize the basic graph structure, then we add to it. The basic idea is that you specify different parts of the plot, and add them together using the `+` operator.

We will start with a blank plot and will find that you will get an error, because you need to add layers.

```{r, eval=FALSE}
ggplot(gapminder) # note the error 
```

Geometric objects are the actual marks we put on a plot. Examples include:

*   `geom_point()`
*   `geom_line()`
*   `geom_boxplot()`

A plot must have at least one geom; there is no upper limit. You can add a geom to a plot using the `+` operator.

```{r, eval=FALSE}
ggplot(gapminder) +
    geom_point() # note what happens here
```

Each type of geom usually has a required set of aesthetics to be set, and usually accepts only a subset of all aesthetics. Refer to the help pages to see what mappings each geom accepts, for instance `help(geom_point)`. Aesthetic mappings are set with the `aes()` function. Examples include:

*   position (`x` and `y` coordinates)
*   color ("outside" color)
*   fill ("inside" color)
*   shape (of points)
*   linetype
*   size

To start, we will add position for the x- and y-axis since `geom_point` requires mappings for x and y (all others are optional)...

## Scatter Plot

```{r}
ggplot(gapminder, aes(x = year, y = lifeExp)) +
    geom_point() +
    ggtitle("Life Expectancy Over Time") +
    xlab(NULL) +
    ylab("Life Expectancy (Years)")
```

Notice how we add three function calls to this plot, `ggtitle()`, `xlab()`, and `ylab()` set the graph title, x-axis label, and y-axis label respectively.

## Histogram

To plot a histogram we use another function `geom_histogram()`.

```{r}
ggplot(gapminder, aes(x = lifeExp)) +
    geom_histogram(binwidth = 1, boundary = 0) +
    xlab("Life Expectancy (Years)") +
    ylab("Frequency") +
    ggtitle("Distribution of Life Expectancy")
```

Experiment with changing the `binwidth` and `boundary` parameters to see how the histogram changes.

## Box Plot

Let's try plotting a box plot similar to what we had done using the base plot functions at the start of this lesson.

```{r}
ggplot(gapminder, aes(x = year, y = lifeExp, group = year)) +
    geom_boxplot() +
    ggtitle("The Distribution of Life Expectancy Over Time") +
    xlab(NULL) +
    ylab("Life Expectancy (Years)")
```

## Why `ggplot2`

```{r, message = FALSE, fig.height = 10}
library(dplyr)

labels <- gapminder %>%
    filter(year == max(year))

ggplot(gapminder, aes(x = year, y = lifeExp, group = country)) +
    geom_point(size = 0.5) +
    geom_line(color = "black", size = 0.1) +
    geom_text(aes(x = year + 1, y = lifeExp, label = country), data = labels, hjust = "left", size = 1.5) +
    ggtitle("Life Expectancy Over Time") +
    xlab(NULL) +
    ylab("Life Expectancy (Years)") +
    facet_grid(continent ~ .) +
    xlim(1950, 2015) +
    theme_bw()
```

## Additional Resources

We have only scratched the surface of `ggplot2`. Here are some additional references:

*   RStudio's [data visualization with ggplot2 cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/12/ggplot2-cheatsheet-2.0.pdf) is an excellent quick reference.
*   The `ggplot2` manual is available online [here](http://docs.ggplot2.org/).
*   [ggplot2: Elegant Graphics for Data Anaysis](https://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/331924275X/) is the definitive book on the subject.
*   Much of the material here was adpapted from IQSS's [Introduction to R graphics with ggplot2](http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html).


# Saving Figures

There are at least three ways to save figures from R.

1.  The easiest way to save a graph is to export directly from the RStudio 'Plots' panel, by clicking on `Export` when the image is plotted. This will give you the option of `png` or `pdf` and selecting the directory to which you wish to save it to.

2.  Use the `ggsave()` function from the `ggplot2` library. This only works with `ggplot` objects.

    ```{r, message = FALSE}
    g <- ggplot(gapminder, aes(x = year, y = lifeExp)) +
        geom_point()
    
    ggsave("example.pdf", g)
    ```
    
    ```{r, echo = FALSE}
    file.remove("example.pdf")
    ```

3.  Use one of R's graphics device drivers. These include `pdf()`, `png()`, `jpeg()`, `tiff()`, and others. Below I illustrate saving a pdf file using this method. After creating your graph be sure to close the image file you are writing.

    ```{r}
    # Open a file for writing.
    pdf("example2.pdf")
    
    # Create a new plot and print it to the active device (example2.pdf).
    plot(x = gapminder$year, y = gapminder$lifeExp)
    
    # Close the file.
    dev.off()
    ```
    
    ```{r, echo = FALSE}
    file.remove("example2.pdf")
    ```
